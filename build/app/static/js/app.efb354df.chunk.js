"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[2143],{2504:function(e,l,t){t.r(l),t.d(l,{default:function(){return _}});var n=t(969),a=t(1949),i={container:"App_container__KkHQY",display:"App_display__XxcrI",marginBottom:"App_marginBottom__vBHuD",padding:"App_padding__Xsu8z",orgHeight:"App_orgHeight__J1WGe",periodFields:"App_periodFields__ZACpN",fields:"App_fields__8P+9M",fieldSelected:"App_fieldSelected__C+6h5"},o=t(7526),d=t(7205);function r(){return n.createElement("div",null,n.createElement("div",{style:{border:"1px solid #c4c9cc",backgroundColor:"lightblue",padding:8,width:"100%"}},n.createElement(o.J,null,n.createElement(d.a,null,"Data Exchange Initializer"))))}var u=t(1611),s=t(2145);function v(e){var l;const[t,a]=(0,n.useState)([]);return n.createElement("div",{style:{padding:"10px",width:"700px"}},n.createElement(u.g,{label:"Data Dimension",className:`${null===e||void 0===e||null===(l=e.styles)||void 0===l?void 0:l.marginBottom}`}),n.createElement(s.F,{filterable:!0,height:"300px",onChange:l=>{a(l.selected),null===e||void 0===e||e.setSelectedDataDimensionsCodes(l.selected)},options:(()=>{var l,t,n,a;let i=[];return null===e||void 0===e||null===(l=e.indicators)||void 0===l||null===(t=l.filter((e=>void 0!==e.code)))||void 0===t||t.map((e=>{i.push({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.code})})),null===e||void 0===e||null===(n=e.dataElements)||void 0===n||null===(a=n.filter((e=>void 0!==e.code)))||void 0===a||a.map((e=>{i.push({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.code})})),i})(),selected:t,selectedEmptyComponent:n.createElement("p",{style:{textAlign:"center",fontSize:"14px",color:"gray"}},"You have not selected anything yet",n.createElement("br",null))}))}var c=t(7966);function m(e){var l;const[t,a]=(0,n.useState)([]);return n.createElement("div",{className:null===e||void 0===e||null===(l=e.styles)||void 0===l?void 0:l.orgHeight},n.createElement(u.g,{label:"Organization units"},n.createElement(c.b,{name:"Organisation Units",onChange:l=>{var t;a(l.selected),null===e||void 0===e||e.setSelecteOrgUnit(null===e||void 0===e||null===(t=e.orgUnits)||void 0===t?void 0:t.filter((e=>(null===e||void 0===e?void 0:e.id)==(null===l||void 0===l?void 0:l.id)))[0])},roots:(e=>{let l=[];return null===e||void 0===e||e.map((e=>{1==(null===e||void 0===e?void 0:e.level)&&(null===l||void 0===l||l.push(null===e||void 0===e?void 0:e.id))})),l})(null===e||void 0===e?void 0:e.orgUnits),singleSelection:!0,hideMemberCount:!1,onSelectClick:e=>{},selected:t})))}var p=t(9122),y=t(5930),E=t(3305),h=t(7773);function g(e,l,t){return l=function(e){var l=function(e,l){if("object"!==typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,l||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===l?String:Number)(e)}(e,"string");return"symbol"===typeof l?l:String(l)}(l),l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}t(4497),t(5749);const f=new class{constructor(){g(this,"GetYearly",(()=>{let e=[],l=(new Date).getFullYear();for(let t=0;t<40;t++)e.push(l-t);return e})),g(this,"getFirstPosition",(e=>e[0])),g(this,"GetWeekly",(()=>{let e=[];for(let l=0;l<56;l++)e.push({name:`Week${l+1}`,value:`${l+1}`});return e})),g(this,"GetBiWeekly",(()=>{let e=[];for(let l=0;l<28;l++)e.push({name:`Week${l+1}`,value:`BI${l+1}`});return e})),g(this,"GetDaily",(()=>[{name:"Monday",value:"01"},{name:"Tuesday",value:"02"},{name:"Wednesday",value:"03"},{name:"Thursday",value:"04"},{name:"Friday",value:"05"},{name:"Saturday",value:"06"},{name:"Sunday",value:"07"}])),g(this,"GetMonthly",(()=>[{name:"January",value:"01"},{name:"February",value:"02"},{name:"March",value:"03"},{name:"April",value:"04"},{name:"May",value:"05"},{name:"June",value:"06"},{name:"July",value:"07"},{name:"August",value:"08"},{name:"September",value:"09"},{name:"October",value:"10"},{name:"November",value:"11"},{name:"December",value:"12"}])),g(this,"GetBiMonthly",(()=>[{name:"January-February",value:"01"},{name:"March-April",value:"02"},{name:"May-June",value:"03"},{name:"July-August",value:"04"},{name:"September-October",value:"05"},{name:"November-December",value:"06"}])),g(this,"GetQuarterly",(()=>[{name:"January-March",value:"Q1"},{name:"April-June",value:"Q2"},{name:"July-September",value:"Q3"},{name:"October-December",value:"Q4"}])),g(this,"GetSixMonthly",(()=>[{name:"January-June",value:"S1"},{name:"July-December",value:"S2"}]))}};function b(e){const l=(0,n.useRef)(0),[t,a]=(0,n.useState)(),[i,o]=(0,n.useState)();return n.createElement("div",null,(d=>{var r,u,s,v;return"Daily"==d?n.createElement("div",{className:`${null===e||void 0===e||null===(r=e.styles)||void 0===r?void 0:r.fieldSelected}`},n.createElement(p.I,{name:"daily",type:"date",onChange:l=>{let t=l.value.replace(/-/g,"");a(t),null===e||void 0===e||e.inputHandler({name:"period",value:t})},placeholder:"Date",className:null===e||void 0===e||null===(u=e.styles)||void 0===u?void 0:u.marginBottom})):n.createElement("div",{className:`${null===e||void 0===e||null===(s=e.styles)||void 0===s?void 0:s.fieldSelected}`},n.createElement(E.q,{className:"select",onChange:t=>{a(t.selected),l.current=t.selected,"Yearly"===d&&(null===e||void 0===e||e.inputHandler({name:"period",value:t.selected}))},placeholder:"--- Select year ---",selected:t},null===f||void 0===f||null===(v=f.GetYearly())||void 0===v?void 0:v.map(((e,l)=>n.createElement(h.a,{key:l,label:e,value:e.toString()})))),(t=>{var a,d,r,u,s,v,c,m,p,y;return"WeeklyWednesday"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(a=f.GetWeekly())||void 0===a?void 0:a.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:"Wed"+(null===e||void 0===e?void 0:e.value)})))):"Weekly"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(d=f.GetWeekly())||void 0===d?void 0:d.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.value})))):"WeeklyThursday"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(r=f.GetWeekly())||void 0===r?void 0:r.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:"Thu"+(null===e||void 0===e?void 0:e.value)})))):"WeeklySaturday"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(u=f.GetWeekly())||void 0===u?void 0:u.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:"Sat"+(null===e||void 0===e?void 0:e.value)})))):"WeeklySunday"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(s=f.GetWeekly())||void 0===s?void 0:s.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:"Sun"+(null===e||void 0===e?void 0:e.value)})))):"BiWeekly"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(v=f.GetBiWeekly())||void 0===v?void 0:v.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.value})))):"Monthly"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(c=f.GetMonthly())||void 0===c?void 0:c.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.value})))):"BiMonthly"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(m=f.GetBiMonthly())||void 0===m?void 0:m.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.value})))):"Quarterly"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(p=f.GetQuarterly())||void 0===p?void 0:p.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.value})))):"SixMonthly"==t?n.createElement(E.q,{className:"select",onChange:t=>{o(t.selected),null===e||void 0===e||e.inputHandler({name:"period",value:`${l.current}${t.selected}`})},selected:i},null===f||void 0===f||null===(y=f.GetSixMonthly())||void 0===y?void 0:y.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.value})))):void 0})(d))})(null===e||void 0===e?void 0:e.periodType))}function S(e){var l,t,a,i,o,d,r,s,v,c,m,g,f,S,N;const[I,C]=(0,n.useState)("EXTERNAL"),[x,k]=(0,n.useState)("Monthly"),[A,T]=(0,n.useState)(),[_,$]=(0,n.useState)(),[w,B]=(0,n.useState)("BASICAUTH"),[H,D]=(0,n.useState)({dexname:"",sourcename:"",url:"",username:"",password:"",token:"",period:""}),G=e=>{D({...H,[null===e||void 0===e?void 0:e.name]:null===e||void 0===e?void 0:e.value})};return(0,n.useEffect)((()=>{null===e||void 0===e||e.formInputs({type:I,authType:w,formInputs:H}),console.clear()}),[H]),n.createElement(u.g,{label:"General",className:`${null===e||void 0===e||null===(l=e.styles)||void 0===l?void 0:l.padding}`},n.createElement("div",{style:{width:"700px"}},n.createElement(p.I,{name:"dexname",type:"text",onChange:G,placeholder:"Name of aggregate data exchange. Unique.",className:null===e||void 0===e||null===(t=e.styles)||void 0===t?void 0:t.marginBottom}),n.createElement(p.I,{name:"sourcename",type:"text",onChange:G,placeholder:"Name of source request",className:null===e||void 0===e||null===(a=e.styles)||void 0===a?void 0:a.marginBottom}),n.createElement(y.x,{className:null===e||void 0===e||null===(i=e.styles)||void 0===i?void 0:i.marginBottom},n.createElement(E.q,{className:"select",onChange:e=>{C(e.selected)},selected:I},n.createElement(h.a,{label:"Internal",value:"INTERNAL"}),n.createElement(h.a,{label:"External",value:"EXTERNAL"}))),"EXTERNAL"==I&&n.createElement(p.I,{name:"url",type:"text",onChange:G,className:null===e||void 0===e||null===(o=e.styles)||void 0===o?void 0:o.marginBottom,placeholder:"Base URL of target DHIS 2 instance, do not include the /api part."}),n.createElement(y.x,{className:`${null===e||void 0===e||null===(d=e.styles)||void 0===d?void 0:d.marginBottom} ${null===e||void 0===e||null===(r=e.styles)||void 0===r?void 0:r.periodFields}`},n.createElement(E.q,{className:`${null===e||void 0===e||null===(s=e.styles)||void 0===s?void 0:s.fields}`,onChange:e=>{k(e.selected)},selected:x},null===e||void 0===e||null===(v=e.periodTypes)||void 0===v?void 0:v.map(((e,l)=>n.createElement(h.a,{key:l,label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name})))),n.createElement(y.x,{className:`${null===e||void 0===e||null===(c=e.styles)||void 0===c?void 0:c.fields}`},n.createElement(b,{periodType:x,inputHandler:G,key:x,styles:null===e||void 0===e?void 0:e.styles}))),"EXTERNAL"==I&&n.createElement(y.x,{className:null===e||void 0===e||null===(m=e.styles)||void 0===m?void 0:m.marginBottom},n.createElement(E.q,{className:null===e||void 0===e||null===(g=e.styles)||void 0===g?void 0:g.marginBottom,selected:w,onChange:e=>{B(e.selected)}},n.createElement(h.a,{label:"Basic auth",value:"BASICAUTH"}),n.createElement(h.a,{label:"Access Token",value:"TOKEN"})),"BASICAUTH"==w?n.createElement("div",{style:{width:"500px",display:"flex",flexFlow:"row",gap:"10px"}},n.createElement(p.I,{name:"username",type:"text",onChange:G,placeholder:"username",className:null===e||void 0===e||null===(f=e.styles)||void 0===f?void 0:f.marginBottom}),n.createElement(p.I,{name:"password",onChange:G,type:"password",className:null===e||void 0===e||null===(S=e.styles)||void 0===S?void 0:S.marginBottom,placeholder:"password"})):n.createElement("div",null,n.createElement(p.I,{name:"token",type:"text",onChange:G,placeholder:"Paste the access token here...",className:null===e||void 0===e||null===(N=e.styles)||void 0===N?void 0:N.marginBottom})))))}var N=t(6475),I=t(7183),C=t(5690),x=t(1591);function k(e,l,t){return l=function(e){var l=function(e,l){if("object"!==typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,l||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===l?String:Number)(e)}(e,"string");return"symbol"===typeof l?l:String(l)}(l),l in e?Object.defineProperty(e,l,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[l]=t,e}const A={organisationUnits:{resource:"organisationUnits",params:{paging:!1,fields:["id,name,level,path,displayName,code,children,ancestors,created,href,user,users,userAccesses"],order:"level"}},indicators:{resource:"indicators",params:{paging:!1,fields:["id","name","displayName","code"]}},dataElements:{resource:"dataElements",params:{paging:!1,fields:["id","name","formName","displayName","code"]}},periodTypes:{resource:"periodTypes",params:{fields:["*"]}}},T=new class{constructor(){k(this,"isValidUrl",(e=>new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)))}};var _=()=>{var e,l,t;const o=(0,a.bQ)(),[d,u]=(0,n.useState)(),[s,c]=(0,n.useState)([]),[p,E]=(0,n.useState)([]),[h,g]=(0,n.useState)(!0),[f,b]=(0,n.useState)(""),[k,_]=(0,n.useState)(!1),[$,w]=(0,n.useState)({INTERNAL:"INTERNAL",EXTERNAL:"EXTERNAL"}),[B,H]=(0,n.useState)({TOKEN:"TOKEN",BASICAUTH:"BASICAUTH"}),{loading:D,error:G,data:U,refetch:W}=(0,a.u_)(A),q=e=>{o.mutate(e).then((e=>{201==e.httpStatusCode&&(_(!0),g(!1),b("Data exchange initialization is successfull\nPlease use the Data Exchange app to submit the Data."))})).catch((e=>{g(!1),b("Error occured. Either server or the inputs causes this error.")}))};return G?n.createElement("span",null," Error : ",G.message):D?n.createElement("span",{style:{display:"flex",width:"100%",height:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center"}},n.createElement(N.V,null)):n.createElement("div",null,n.createElement("div",null,n.createElement(r,null),n.createElement("br",null),n.createElement("div",{className:i.display},n.createElement(S,{styles:i,formInputs:e=>{u(e)},formData:d,periodTypes:null===U||void 0===U||null===(e=U.periodTypes)||void 0===e?void 0:e.periodTypes}),n.createElement("br",null),n.createElement(v,{indicators:null===U||void 0===U||null===(l=U.indicators)||void 0===l?void 0:l.indicators,dataElements:null===U||void 0===U||null===(t=U.dataElements)||void 0===t?void 0:t.dataElements,setSelectedDataDimensionsCodes:E}),n.createElement("br",null),n.createElement("div",null,n.createElement(m,{orgUnits:U.organisationUnits.organisationUnits,setSelecteOrgUnit:c,styles:i})),n.createElement("br",null)),n.createElement(I.i,null),n.createElement("div",{style:{padding:"20px",justifyContent:"start",display:"flex"}},n.createElement(C.z,{name:"submit",primary:!0,onClick:()=>{var e,l,t,n,a,i,o,r;let u={resource:"aggregateDataExchanges",type:"create",data:{name:null===d||void 0===d||null===(e=d.formInputs)||void 0===e?void 0:e.dexname,source:{requests:[{name:null===d||void 0===d||null===(l=d.formInputs)||void 0===l?void 0:l.sourcename,dx:p,pe:[null===d||void 0===d||null===(t=d.formInputs)||void 0===t?void 0:t.period],ou:[null===s||void 0===s?void 0:s.code],inputIdScheme:"code",outputIdScheme:"code"}]},target:{type:null===d||void 0===d?void 0:d.type,api:{url:null===d||void 0===d||null===(n=d.formInputs)||void 0===n?void 0:n.url,username:null===d||void 0===d||null===(a=d.formInputs)||void 0===a?void 0:a.username,password:null===d||void 0===d||null===(i=d.formInputs)||void 0===i?void 0:i.password},request:{idScheme:"code"}}}};if(void 0==(null===d||void 0===d||null===(o=d.formInputs)||void 0===o?void 0:o.dexname))b("Name is missing"),g(!1);else if(void 0==(null===d||void 0===d||null===(r=d.formInputs)||void 0===r?void 0:r.period))b("Period is missing"),g(!1);else{var v,c,m,y,E,h;if((null===d||void 0===d?void 0:d.type)==(null===$||void 0===$?void 0:$.EXTERNAL)){if(""==(null===d||void 0===d||null===(v=d.formInputs)||void 0===v?void 0:v.url))b("Please enter target DHIS2 instance url"),g(!1);else if(0==T.isValidUrl(null===d||void 0===d||null===(c=d.formInputs)||void 0===c?void 0:c.url))b("The email format is invalid."),g(!1);else if(1==((null===d||void 0===d?void 0:d.authType)==B.BASICAUTH))void 0==(null===d||void 0===d||null===(m=d.formInputs)||void 0===m?void 0:m.username)||""==(null===d||void 0===d||null===(y=d.formInputs)||void 0===y?void 0:y.username)||void 0==(null===d||void 0===d||null===(E=d.formInputs)||void 0===E?void 0:E.password)||""==(null===d||void 0===d||null===(h=d.formInputs)||void 0===h?void 0:h.password)?(b("Username or password is missing"),g(!1)):q(u)}else q(u)}},value:"default"},"Initialise Integration"),n.createElement("div",{style:{marginLeft:"50px"}},n.createElement(y.x,null,1==k?n.createElement(x.N,{hidden:h,success:!0,duration:4e3,onHidden:e=>{g(!0),window.location.reload(!0)}},f):n.createElement(x.N,{hidden:h,warning:!0,duration:4e3,onHidden:e=>{g(!0)}},f))))))}}}]);
//# sourceMappingURL=app.efb354df.chunk.js.map